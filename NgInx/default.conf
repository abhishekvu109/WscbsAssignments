# Reference taken from https://stackoverflow.com/questions/68196179/how-to-create-reverse-proxy-for-multiple-websites-in-nginx
# ------------------------------------------------------------------------------------------------------------------------------------------------------
# Also create 2 hosts entry in /etc/hosts file in VM for 'user-auth.service' and 'url-shortener.service' to 172.18.0.1 (due to custom network creation)
# ------------------------------------------------------------------------------------------------------------------------------------------------------

# web service1 AuthService config.
server {
		listen 6060;
		server_name user-auth.service;

		location / {
			include /etc/nginx/includes/proxy.conf;
			# testing - proxy_pass http://172.18.0.1:7070/api/auth/;
			proxy_pass http://user-auth.service:7070/api/auth/;
		}	
}


# web service2 URLShortener config.
server {
		listen 6060;
		server_name url-shortener.service;

		location / {
			include /etc/nginx/includes/proxy.conf;
			# testing - proxy_pass http://172.18.0.1:8080/api/urlshortener/;
			proxy_pass http://url-shortener.service:8080/api/urlshortener/;
		}
}

# Default Nginx server as API gateway
server {
		listen 6060 default_server;

		server_name _;
		root /var/www/html;

		charset UTF-8;
		
		error_page 404 /backend-not-found.html;
		location = /backend-not-found.html {
			allow all;
		}

		location / {
			return 404;
		}

		error_log /var/log/nginx/error.log error;
}
